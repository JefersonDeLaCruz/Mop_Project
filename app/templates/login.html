{% extends './base.html' %}

{% block title %} {{ _('Iniciar Sesión') }} - LP Solver{% endblock %}

{% block tailwindcss %} {{super()}} {% endblock %}

{% block nav %}{% endblock %}

{% block main %}

<div
  class="login-container h-screen 
  animated-gradient bg-gradient-to-r from-purple-400 via-pink-500 to-red-500">

  <div class="grid grid-cols-1 md:grid-cols-2">

    <!-- Columna Izquierda - Formulario -->
    <div data-theme="dark" class="login-container h-dvh bg-neutral flex flex-col items-center justify-center">

      <!-- FORMULARIO INICIA AQUÍ -->
      <form action="{{ url_for('main.login') }}" method="post"
        class="fields-container flex flex-col gap-2.5 place-self-center items-center justify-center">

        <h1 class="text-center text-2xl mb-8">{{ _("Bienvenido de nuevo") }}</h1>

        <!-- campo para el username -->
        <label class="input input-secondary rounded-full">
          <i class="fas fa-user opacity-50 h-[1em] w-[1em]"></i>
          <input id="username" name="username" type="text" placeholder="{{ _('Usuario') }}" />
        </label>

        <!-- campo para la contra -->
        <label class="input input-secondary rounded-full">
          <i class="fas fa-lock opacity-50 h-[1em] w-[1em]"></i>
          <input id="password" name="password" type="password" placeholder="{{ _('Contraseña') }}" />
        </label>

        <!-- boton para acceder -->
        <div>
          <button type="submit" class="btn btn-outline btn-secondary rounded-full">
            {{ _("Iniciar sesion") }}
          </button>
        </div>

        <!-- Enlace para ir al registro -->
        <div class="mt-4">
          <p class="text-center text-sm text-gray-400">
            {{ _("¿No tienes cuenta?") }}
            <a href="{{ url_for('main.register') }}" class="link link-hover text-secondary hover:text-secondary-focus font-medium ml-1">
              {{ _("Regístrate aquí") }}
            </a>
          </p>
        </div>
      </form>
      <!-- FORMULARIO TERMINA AQUÍ -->

    </div>

    <!-- Columna Derecha - Elementos Visuales -->
    <div class="hidden md:flex h-dvh relative overflow-hidden items-center justify-center">
      
      <!-- Contenedor principal del contenido -->
      <div class="relative z-10 text-center text-white px-8">
        <!-- Logo/Icono principal -->
        <div class="mb-8 relative">
          <div class="w-24 h-24 mx-auto bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center mb-4 animate-pulse">
            <i class="fas fa-chart-line text-4xl text-white"></i>
          </div>
          <h2 class="text-3xl font-bold mb-2">OptimizeFlow</h2>
          <p class="text-xl opacity-90">{{ _('Solver de Programación Lineal') }}</p>
        </div>

        <!-- Features destacados -->
        <div class="space-y-4 mb-8">
          <div class="flex items-center justify-center space-x-3 animate-fade-in" style="animation-delay: 0.5s;">
            <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center">
              <i class="fas fa-bullseye text-sm"></i>
            </div>
            <span class="text-lg">{{ _('Optimización de funciones objetivo') }}</span>
          </div>
          <div class="flex items-center justify-center space-x-3 animate-fade-in" style="animation-delay: 1s;">
            <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center">
              <i class="fas fa-project-diagram text-sm"></i>
            </div>
            <span class="text-lg">{{ _('Análisis de restricciones') }}</span>
          </div>
          <div class="flex items-center justify-center space-x-3 animate-fade-in" style="animation-delay: 1.5s;">
            <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center">
              <i class="fas fa-calculator text-sm"></i>
            </div>
            <span class="text-lg">{{ _('Soluciones matemáticas precisas') }}</span>
          </div>
        </div>

        <!-- Ecuación decorativa animada -->
        <div class="text-2xl font-mono opacity-75 animate-pulse">
          <div>max f(x) = c₁x₁ + c₂x₂</div>
          <div class="text-lg mt-2">sujeto a: Ax ≤ b</div>
        </div>
      </div>

      <!-- Elementos flotantes decorativos -->
      <div class="absolute inset-0 overflow-hidden pointer-events-none">
        <!-- Formas geométricas flotantes -->
        <div class="absolute top-20 left-20 w-16 h-16 bg-white/10 rounded-lg rotate-12 animate-float"></div>
        <div class="absolute top-40 right-32 w-12 h-12 bg-white/15 rounded-full animate-float-delayed"></div>
        <div class="absolute bottom-32 left-16 w-20 h-20 bg-white/10 rounded-lg rotate-45 animate-float-slow"></div>
        <div class="absolute bottom-20 right-20 w-8 h-8 bg-white/20 rounded-full animate-float"></div>
        <div class="absolute top-1/2 right-8 w-6 h-6 bg-white/15 rounded-lg animate-float-delayed"></div>
        
        <!-- Líneas conectoras decorativas -->
        <svg class="absolute inset-0 w-full h-full opacity-20">
          <defs>
            <linearGradient id="lineGrad" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" style="stop-color:white;stop-opacity:0.3" />
              <stop offset="100%" style="stop-color:white;stop-opacity:0" />
            </linearGradient>
          </defs>
          <path d="M100,200 Q300,100 500,300" stroke="url(#lineGrad)" stroke-width="2" fill="none" class="animate-pulse"/>
          <path d="M50,400 Q250,300 450,500" stroke="url(#lineGrad)" stroke-width="2" fill="none" class="animate-pulse" style="animation-delay: 1s;"/>
        </svg>
      </div>

      <!-- Partículas flotantes pequeñas -->
      <div class="absolute inset-0">
        <div class="absolute top-1/4 left-1/4 w-2 h-2 bg-white/30 rounded-full animate-ping"></div>
        <div class="absolute top-3/4 right-1/4 w-1 h-1 bg-white/40 rounded-full animate-ping" style="animation-delay: 2s;"></div>
        <div class="absolute top-1/2 left-1/3 w-1.5 h-1.5 bg-white/35 rounded-full animate-ping" style="animation-delay: 1s;"></div>
      </div>
    </div>
    <!-- hsat aqi -->
  </div>

</div>

<!-- Estilos CSS personalizados -->
<style>
@keyframes float {
  0%, 100% { transform: translateY(0px) rotate(0deg); }
  50% { transform: translateY(-20px) rotate(10deg); }
}

@keyframes float-delayed {
  0%, 100% { transform: translateY(0px) rotate(0deg); }
  50% { transform: translateY(-15px) rotate(-10deg); }
}

@keyframes float-slow {
  0%, 100% { transform: translateY(0px) rotate(45deg); }
  50% { transform: translateY(-10px) rotate(55deg); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-float-delayed {
  animation: float-delayed 8s ease-in-out infinite 2s;
}

.animate-float-slow {
  animation: float-slow 10s ease-in-out infinite 1s;
}

@keyframes fade-in {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

.animate-fade-in {
  animation: fade-in 1s ease-out forwards;
  opacity: 0;
}

.animated-gradient {
  background-size: 300% 300%;
  animation: gradient-shift 8s ease infinite;
}

@keyframes gradient-shift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}
</style>

<!-- Script para mostrar mensajes flash con Notyf -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Función para esperar a que alerta esté disponible
        function waitForAlerta(callback) {
          if (typeof window.alerta !== 'undefined') {
            callback();
          } else {
            setTimeout(() => waitForAlerta(callback), 50);
          }
        }
        
        // Esperar a que alerta esté disponible antes de mostrar mensajes
        waitForAlerta(function() {
          {% for category, message in messages %}
            {% if category == 'error' %}
              window.alerta.open({
                type: "error",
                message: `{{ message | safe }}`
              });
            {% elif category == 'success' %}
              window.alerta.open({
                type: "success", 
                message: `{{ message | safe }}`
              });
            {% elif category == 'warning' %}
              window.alerta.open({
                type: "warning",
                message: `{{ message | safe }}`
              });
            {% elif category == 'info' %}
              window.alerta.open({
                type: "info",
                message: `{{ message | safe }}`
              });
            {% endif %}
          {% endfor %}
        });
      });
    </script>
  {% endif %}
{% endwith %}

{% if login_success %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Esperar 2.5 segundos para que el usuario vea el mensaje de éxito
    // antes de redirigir al dashboard
    setTimeout(function() {
      window.location.href = "{{ url_for('main.dashboard') }}";
    }, 2500);
  });
</script>
{% endif %}

{% endblock %}